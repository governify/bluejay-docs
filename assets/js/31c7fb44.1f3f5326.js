"use strict";(self.webpackChunkbluejay_docs=self.webpackChunkbluejay_docs||[]).push([[5165],{60:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/scopes-baf296b2b7972e46f6d3b7b26f6679ee.png"},134:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"development/setup-development-environment/docker-compose","title":"Docker Compose","description":"Docker Compose deployed locally","source":"@site/versioned_docs/version-1.0/development/setup-development-environment/docker-compose.md","sourceDirName":"development/setup-development-environment","slug":"/development/setup-development-environment/docker-compose","permalink":"/1.0/development/setup-development-environment/docker-compose","draft":false,"unlisted":false,"editUrl":"https://github.com/governify/bluejay-docs/edit/main/versioned_docs/version-1.0/development/setup-development-environment/docker-compose.md","tags":[],"version":"1.0","lastUpdatedBy":"Pablo Fernandez","lastUpdatedAt":1751790918000,"sidebarPosition":1,"frontMatter":{"title":"Docker Compose","description":"Docker Compose deployed locally","sidebar_position":1,"hide_table_of_contents":false},"sidebar":"defaultSidebar","previous":{"title":"Setup Development Environment","permalink":"/1.0/development/setup-development-environment/intro"},"next":{"title":"Nodejs","permalink":"/1.0/development/setup-development-environment/nodejs/intro"}}');var s=o(4848),i=o(8453);const r={title:"Docker Compose",description:"Docker Compose deployed locally",sidebar_position:1,hide_table_of_contents:!1},c="Docker Compose Deployment",a={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"1. Clone Repo",id:"1-clone-repo",level:2},{value:"2. Add &#39;.env&#39; file",id:"2-add-env-file",level:2},{value:"2.1 Create Github token",id:"21-create-github-token",level:3},{value:"3. Deploy with Docker Compose",id:"3-deploy-with-docker-compose",level:2},{value:"4. Create scopes.json",id:"4-create-scopesjson",level:2},{value:"5. Useful commands and information",id:"5-useful-commands-and-information",level:3},{value:"6. Create a new TPA for the project",id:"6-create-a-new-tpa-for-the-project",level:2},{value:"7. Compute the TPA",id:"7-compute-the-tpa",level:2},{value:"8. Next Steps",id:"8-next-steps",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"docker-compose-deployment",children:"Docker Compose Deployment"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"This guide deploys bluejay with the docker ecosystem in a local/development environment. During this guide the system is deployed with docker, a class is created, a TPA is created for that class and a calculation is carried out to display the first points on the graphs."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Windows OS, Linux or macOS with the following installed packages:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"docker"}),"\n",(0,s.jsx)(n.li,{children:"docker-compose (version 1.27 or greater)"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Ports 80, 443 open on the server."}),"\n",(0,s.jsx)(n.li,{children:"In case you are running a linux machine, you need to asociate the host.docker.internal url to 172.17.0.1 (docker's gateway)"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ssh",children:"host-manager -add host.docker.internal 172.17.0.1\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Most of Bluejay's Docker images are built using the linux/amd64 platform. If using a computer with an ARM processor (such as a ",(0,s.jsx)(n.strong,{children:"Mac with Apple Silicon"})," or a ",(0,s.jsx)(n.strong,{children:"PC with Snapdragon X"}),"), see more details in ",(0,s.jsx)(n.a,{href:"#3-deploy-with-docker-compose",children:"section 3"})," below. Please note that some Docker or OS updates may break compatibility with amd64 images."]})}),"\n",(0,s.jsx)(n.h2,{id:"1-clone-repo",children:"1. Clone Repo"}),"\n",(0,s.jsxs)(n.p,{children:["Clone latest release of ",(0,s.jsx)(n.a,{href:"https://github.com/governify/bluejay-infrastructure",children:"Bluejay Infrastructure repository"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bin/bash",children:"git clone https://github.com/governify/bluejay-infrastructure.git\n"})}),"\n",(0,s.jsx)(n.h2,{id:"2-add-env-file",children:"2. Add '.env' file"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:".env"})," file is used to configure environmental variables used in your specific deployment. The content of this file must be the following:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# GENERAL (Mandatory for deployment)\n\nGOV_INFRASTRUCTURE=http://host.docker.internal:5200/api/v1/public/infrastructure-local.yaml \n# For service registry\n\nNODE_ENV=development \n# Development environment\n\n\n# Repository branch\nASSETS_REPOSITORY_BRANCH=develop \n# Repository of static files\n\n# Influx database url\nINFLUX_URL=http://host.docker.internal:5002\n\n# Event collector\nKEY_GITHUB=<key> \n# In the section below we will specify how to generate this token\n\n# Frontends access account\nUSER_RENDER=bluejay\nPASS_RENDER=bluejay\nUSER_ASSETS=bluejay\nPASS_ASSETS=bluejay\n# Here you can stablish the credentials to acces Bluejay's frontend\n\n# Assets manager\nKEY_ASSETS_MANAGER_PRIVATE=bluejay-assets-private-key\n# Internal key\n\n# Scope manager\nKEY_SCOPE_MANAGER=bluejay-scopes-private-key\n# Internal key\n\n# Compose config\nCOMPOSE_HTTP_TIMEOUT=200\n"})}),"\n",(0,s.jsx)(n.h3,{id:"21-create-github-token",children:"2.1 Create Github token"}),"\n",(0,s.jsx)(n.p,{children:"Generating a Github token is an essential step. With this key Blujay is able to communicate with the app to retrieve information about the repository that you want to audit. This token is not generated in any specific repo, it serves as a personal private API key in your account."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Navigate to your github account and then go to  ",(0,s.jsx)(n.code,{children:"Settings>Developer Settings"})," (at the end of the menu)."]}),"\n",(0,s.jsxs)(n.li,{children:["Go to ",(0,s.jsx)(n.code,{children:"Personal access tokens > Tokens (classic)"})]}),"\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Generate new token > Generate new token (classic)"})]}),"\n",(0,s.jsxs)(n.li,{children:["The scopes you select are up to you, but you need at least ",(0,s.jsx)(n.strong,{children:"repository"}),", ",(0,s.jsx)(n.strong,{children:"project"})," and ",(0,s.jsx)(n.strong,{children:"user"})," access."]}),"\n",(0,s.jsxs)(n.li,{children:["Click on ",(0,s.jsx)(n.code,{children:"Generate token"})," and make sure to copy the given key and paste it into ",(0,s.jsx)(n.code,{children:"KEY_GITHUB"})," in the ",(0,s.jsx)(n.code,{children:".env"})," file."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"3-deploy-with-docker-compose",children:"3. Deploy with Docker Compose"}),"\n",(0,s.jsx)(n.p,{children:"Now we can deploy the system with the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bin/bash",children:"docker-compose -f docker-bluejay/docker-compose-local.yaml --env-file .env up -d \n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["If using a computer with an ARM processor (such as a ",(0,s.jsx)(n.strong,{children:"Mac with Apple Silicon"})," or a ",(0,s.jsx)(n.strong,{children:"PC with Snapdragon X"}),"), modify the ",(0,s.jsx)(n.code,{children:"version"})," in the docker-compose-local.yaml file to ",(0,s.jsx)(n.code,{children:"2.4"})," and add ",(0,s.jsx)(n.code,{children:"platform: linux/amd64"})," to each service that fails to launch. Alternatively, set the environment variable ",(0,s.jsx)(n.code,{children:"DOCKER_DEFAULT_PLATFORM"})," to ",(0,s.jsx)(n.code,{children:"linux/amd64"}),"."]})}),"\n",(0,s.jsxs)(n.p,{children:["Navigate to localhost:5100 to access the main page of Bluejay. A prompt like the following will pop up in your browser, where have to input the ",(0,s.jsx)(n.code,{children:"USER_RENDER"})," and ",(0,s.jsx)(n.code,{children:"PASS_RENDER"})," values specified in the ",(0,s.jsx)(n.code,{children:".env"})," file:\n",(0,s.jsx)(n.img,{alt:"Login",src:o(4947).A+"",width:"395",height:"278"})]}),"\n",(0,s.jsx)(n.p,{children:"Governify ecosystem with bluejay services should have been deployed in your machine."}),"\n",(0,s.jsx)(n.h2,{id:"4-create-scopesjson",children:"4. Create scopes.json"}),"\n",(0,s.jsxs)(n.p,{children:["Within the ",(0,s.jsx)(n.code,{children:"assets/private/scope-manager"})," directory, you will discover a file named ",(0,s.jsx)(n.code,{children:"scopes.json.example"}),". This file serves as a blueprint, guiding us in the creation of our custom ",(0,s.jsx)(n.code,{children:"scopes.json"}),", which will be located within the same directory as the example. You can copy the following contents into your scopes file as a test, although the ",(0,s.jsx)(n.code,{children:"scopes.json.example"})," file already includes this content. We will use a test repository to audit our first project and which you can find on github: ",(0,s.jsx)(n.a,{href:"https://github.com/governify/bluejay-showcase",children:"bluejay-showcase"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "development": [\n        {\n            "classId": "showcase",\n            "identities": [],\n            "credentials": [],\n            "projects": [\n                {\n                    "name": "bluejay-showcase",\n                    "owner": "L2",\n                    "teamId": "08",\n                    "projectId": "showcase-GH-governify_bluejay-showcase",\n                    "notifications": {\n                        "email": ""\n                    },\n                    "credentials": [],\n                    "identities": [\n                        {\n                            "source": "github",\n                            "repository": "bluejay-showcase",\n                            "repoOwner": "governify"\n                        }\n                    ],\n                    "members": [\n                        {\n                            "memberId": "Javi_Fdez",\n                            "identities": [\n                                {\n                                    "source": "github",\n                                    "username": "JaviFdez7"\n                                }\n                            ],\n                            "credentials": []\n                        },\n                        {\n                            "memberId": "Pablo_Fdez",\n                            "identities": [\n                                {\n                                    "source": "github",\n                                    "username": "pafmon"\n                                }\n                            ],\n                            "credentials": []\n                        }\n                    ]\n                }\n            ]\n        }\n    ]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The scope directory should look like this:\n",(0,s.jsx)(n.img,{alt:"scopes.json",src:o(60).A+"",width:"1920",height:"1030"})]}),"\n",(0,s.jsxs)(n.p,{children:["Now you have to restart the ",(0,s.jsx)(n.code,{children:"scope-manager"})," container in docker. Once restarted you will be able to view the showcase project in the user interface\n",(0,s.jsx)(n.img,{alt:"BJ",src:o(8476).A+"",width:"1465",height:"797"})]}),"\n",(0,s.jsx)(n.h3,{id:"5-useful-commands-and-information",children:"5. Useful commands and information"}),"\n",(0,s.jsxs)(n.p,{children:["If you modify the scopes.json to add more projects or make any change after deploying the ecosystem, you will have to restart the ",(0,s.jsx)(n.code,{children:"scope-manager"})," container."]}),"\n",(0,s.jsx)(n.p,{children:"To stop the containers use:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker-compose -f docker-bluejay/docker-compose-local.yaml --env-file .env stop\n"})}),"\n",(0,s.jsx)(n.p,{children:"You can easily restart them using:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker-compose -f docker-bluejay/docker-compose-local.yaml --env-file .env start\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If you made a change in the configuration you will have to re-compose the containers using ",(0,s.jsx)(n.code,{children:"down"}),"and then using ",(0,s.jsx)(n.code,{children:"up"})," or ",(0,s.jsx)(n.code,{children:"up -d"})," again:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker-compose -f docker-bluejay/docker-compose-local.yaml --env-file .env down # stop and remove containers\n\ndocker-compose -f docker-bluejay/docker-compose-local.yaml --env-file .env up -d # deploy\n"})}),"\n",(0,s.jsx)(n.h2,{id:"6-create-a-new-tpa-for-the-project",children:"6. Create a new TPA for the project"}),"\n",(0,s.jsxs)(n.p,{children:["The TPA you are going to create provides information about the number of issues in progress that the members of the repository have in the project. You can find the complete TPA in the ",(0,s.jsx)(n.a,{href:"https://github.com/governify/zoo/blob/main/bluejay/tpa/showcase/basic/v1.1/tpa-showcase-basic-v1.1.json",children:"zoo repository"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["In the user interface, click on the project's Create TPA button located under Other Projects\n",(0,s.jsx)(n.img,{alt:"Create-TPA",src:o(3693).A+"",width:"1812",height:"883"})]}),"\n",(0,s.jsx)(n.p,{children:"You have now created the TPA for the test project. This is what you will see in the user interface. It is time to compute this TPA to see how the work team is performing."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Created-TPA",src:o(7241).A+"",width:"1817",height:"867"})}),"\n",(0,s.jsx)(n.h2,{id:"7-compute-the-tpa",children:"7. Compute the TPA"}),"\n",(0,s.jsx)(n.p,{children:"From the user interface, we click on the TPA button in the project and access the TPA details. In this new menu we click on Calculate Metrics. We enter the time and date you are currently on (take into account the time zone and enter exactly 1 hour (59 minutes and 59 seconds) for this test) and click on compute."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Calculate-metrics",src:o(7511).A+"",width:"1833",height:"862"})}),"\n",(0,s.jsx)(n.p,{children:"Now you must wait about 10 seconds or access the reporter logs, which will notify you when the elements have been inserted into the graphs."}),"\n",(0,s.jsx)(n.p,{children:"Then access the dashboard with the following credentials:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["User: ",(0,s.jsx)(n.strong,{children:"governify-admin"})]}),"\n",(0,s.jsxs)(n.li,{children:["Password: ",(0,s.jsx)(n.strong,{children:"governify-project"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"And see the information that has been generated according to the data from the github repository"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"grafana-points",src:o(3759).A+"",width:"1746",height:"641"})}),"\n",(0,s.jsx)(n.h2,{id:"8-next-steps",children:"8. Next Steps"}),"\n",(0,s.jsxs)(n.p,{children:["For more information on how a TPA works, visit our documentation on ",(0,s.jsx)(n.a,{href:"/customization/agreement-modeling/team-practices-agreements",children:"TPA configurations"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["If you want to know the complete architecture of the ecosystem, visit the ",(0,s.jsx)(n.a,{href:"https://docs.governify.io/architecture/intro",children:"governify architecture documentation"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["If you find any errors or want to propose any improvements to the documentation, follow this ",(0,s.jsx)(n.a,{href:"https://docs.governify.io/development/contributing/contributing-to-docs",children:"contribution guide"})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},3693:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/create-tpa-a76cfa33d1c0fd73b368e097554e9f02.png"},3759:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/grafana-points-2f114b41f458579ddad5dacc2272dfc4.png"},4947:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/login-render-f0e0d06929064c7faa96ee3411493789.png"},7241:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/created-tpa-1dd5ddec8ef848c6831c5a7f8c851901.png"},7511:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/calculate-metrics-258d2ea1b01cc5b0d031fcfd0eff9d4c.png"},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>c});var t=o(6540);const s={},i=t.createContext(s);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(i.Provider,{value:n},e.children)}},8476:(e,n,o)=>{o.d(n,{A:()=>t});const t=o.p+"assets/images/render-bluejay-0c105eedbb4d0f84109054caf6c7d332.png"}}]);